(()=>{"use strict";function t(t,e,i,n,r,s,a,o){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),a?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},c._ssrRegister=l):r&&(l=o?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}const e=t({mixins:[Fieldtype],inject:["storeName"],data:function(){return{editing:!1,saving:!1,pending:this.value}},computed:{input:function(){return this.$refs.input.$refs.input},entry:function(){return this.$store.state.publish[this.storeName].values.id}},methods:{edit:function(){this.editing=!0,this.input.focus()},stopEditing:function(){this.editing=!1},confirm:function(){var t=this;this.stopEditing(),this.saving=!0,this.$axios.patch(cp_url("popular/pageviews/".concat(this.entry)),{views:this.pending}).then((function(){var e=t.$dirty.has(t.storeName);t.update(t.pending),t.$dirty.state(t.storeName,e),t.$toast.success(__("Pageviews updated"))})).catch((function(){t.resetPending(),t.$toast.error(__("Something went wrong"))})).finally((function(){t.saving=!1}))},cancel:function(){this.stopEditing(),this.resetPending()},updatePending:function(t){this.pending=parseInt(t),this.pending<0&&(this.pending=0)},resetPending:function(){this.pending=this.value}}},(function(){var t=this,e=t._self._c;return e("div",[e("text-input",{ref:"input",attrs:{type:t.editing?"number":"text","is-read-only":!t.editing,value:t.pending},on:{input:t.updatePending}}),t._v(" "),t.saving?e("div",{staticClass:"mt-1 h-6 px-1 flex justify-end text-sm"},[e("loading-graphic",{attrs:{inline:"",text:t.__("Saving")}})],1):t.config.editable?e("div",{staticClass:"mt-1 h-6 px-1 flex justify-between text-sm"},[t.editing?t._e():e("button",{staticClass:"text-button text-blue hover:text-grey-80 mr-3 flex items-center outline-none",on:{click:t.edit}},[t._v("\n            "+t._s(t.__("Edit"))+"\n        ")]),t._v(" "),t.editing?e("button",{staticClass:"text-button text-blue hover:text-grey-80 mr-3 flex items-center outline-none",on:{click:t.cancel}},[t._v("\n            "+t._s(t.__("Cancel"))+"\n        ")]):t._e(),t._v(" "),t.editing?e("button",{staticClass:"text-button text-blue hover:text-grey-80 flex items-center outline-none",on:{click:t.confirm}},[t._v("\n            "+t._s(t.__("Confirm"))+"\n        ")]):t._e()]):t._e()],1)}),[],!1,null,null,null).exports;function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function s(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==i(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,r,s,a,o=[],l=!0,c=!1;try{if(s=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;l=!1}else for(;!(l=(n=s.call(i)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(t){c=!0,r=t}finally{try{if(!l&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}var l=t({mixins:[{methods:{actionStarted:function(){this.loading=!0},actionCompleted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!1,!1!==t&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),!1!==e.message&&this.$toast.success(e.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted:function(){this.request()}}},{data:function(){return{activeFilterBadges:{},activeFilters:{},activePreset:null,activePresetPayload:{},searchQuery:""}},computed:{activeFilterCount:function(){var t=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(t=t+Object.keys(this.activeFilters.fields).filter((function(t){return"badge"!=t})).length-1),t},canSave:function(){return this.isDirty&&this.preferencesPrefix},isDirty:function(){return!!this.isFiltering&&(!this.activePreset||(this.activePresetPayload.query!=this.searchQuery||!_.isEqual(this.activePresetPayload.filters||{},this.activeFilters)))},isFiltering:function(){return!_.isEmpty(this.activeFilters)||this.searchQuery||this.activePreset},hasActiveFilters:function(){return this.activeFilterCount>0},searchPlaceholder:function(){return this.activePreset?__("Searching in: ")+this.activePresetPayload.display:__("Search")}},created:function(){var t=this;this.$keys.bind("f",(function(e){e.preventDefault(),t.handleShowFilters()}))},methods:{searchChanged:function(t){this.searchQuery=t},hasFields:function(t){for(var e in t)if(t[e])return!0;return!1},filterChanged:function(t){var e=t.handle,i=t.values,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&this.hasFields(i)?Vue.set(this.activeFilters,e,i):Vue.delete(this.activeFilters,e),n&&this.unselectAllItems()},filtersChanged:function(t){for(var e in this.activeFilters={},t){var i=t[e];this.filterChanged({handle:e,values:i},!1)}this.unselectAllItems()},filtersReset:function(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems:function(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset:function(t,e){this.activePreset=t,this.activePresetPayload=e,this.searchQuery=e.query,this.filtersChanged(e.filters)},autoApplyFilters:function(t){if(t){var e={};t.filter((function(t){return!_.isEmpty(t.auto_apply)})).forEach((function(t){e[t.handle]=t.auto_apply})),this.activeFilters=e}}}},{props:{initialPerPage:{type:Number,default:function(){return Statamic.$config.get("paginationSize")}}},data:function(){return{perPage:this.initialPerPage,page:1}},mounted:function(){this.setInitialPerPage()},methods:{setInitialPerPage:function(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage:function(t){var e=this;t=parseInt(t),(this.hasPreferences?this.setPreference("per_page",t!=this.initialPerPage?t:null):Promise.resolve()).then((function(i){e.perPage=t,e.resetPage()}))},selectPage:function(t){this.page=t,this.$events.$emit("clear-selections")},resetPage:function(){this.page=1,this.$events.$emit("clear-selections")}}},{data:function(){return{preferencesPrefix:null}},computed:{hasPreferences:function(){return null!==this.preferencesPrefix}},methods:{preferencesKey:function(t){return"".concat(this.preferencesPrefix,".").concat(t)},getPreference:function(t){return this.$preferences.get(this.preferencesKey(t))},setPreference:function(t,e){return this.$preferences.set(this.preferencesKey(t),e)},removePreference:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.$preferences.remove(this.preferencesKey(t),e)}}}],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:function(){return[]}},filters:Array,actionUrl:String},data:function(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter((function(t){return t.visible})),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null,pushQuery:!1,popping:!1}},computed:{parameterMap:function(){return{sort:"sortColumn",order:"sortDirection",page:"page",perPage:"perPage",search:"searchQuery",filters:"activeFilterParameters",columns:"visibleColumnParameters"}},parameters:{get:function(){var t=this;return r(r({},Object.fromEntries(Object.entries(this.parameterMap).map((function(e){var i=a(e,2),n=i[0],r=i[1];return[n,t[r]]})).filter((function(t){var e=a(t,2),i=(e[0],e[1]);return null!=i&&""!==i})))),this.additionalParameters)},set:function(t){var e=this;Object.entries(this.parameterMap).forEach((function(i){var n=a(i,2),r=n[0],s=n[1];t.hasOwnProperty(r)&&(e[s]=t[r])}))}},activeFilterParameters:{get:function(){return _.isEmpty(this.activeFilters)?null:utf8btoa(JSON.stringify(this.activeFilters))},set:function(t){this.activeFilters=JSON.parse(utf8atob(t))}},visibleColumnParameters:{get:function(){return _.isEmpty(this.visibleColumns)?null:this.visibleColumns.map((function(t){return t.field})).join(",")},set:function(t){var e=this;this.visibleColumns=t.split(",").map((function(t){return e.columns.find((function(e){return e.field===t}))}))}},additionalParameters:function(){return{}},shouldRequestFirstPage:function(){return this.page>1&&0===this.items.length&&(this.page=1,!0)}},created:function(){this.autoApplyFilters(this.filters),this.autoApplyState(),this.request()},mounted:function(){this.pushQuery&&(window.history.replaceState({parameters:this.parameters},""),window.addEventListener("popstate",this.popState))},beforeDestroy:function(){this.pushQuery&&window.removeEventListener("popstate",this.popState)},watch:{parameters:{deep:!0,handler:function(t,e){e.search===t.search&&JSON.stringify(e)!==JSON.stringify(t)&&(this.request(),this.pushState())}},loading:{immediate:!0,handler:function(t){this.$progress.loading(this.listingKey,t)}},searchQuery:function(t){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request(),this.pushState()}},methods:{request:function(){var t=this;this.requestUrl?(this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then((function(e){if(t.columns=e.data.meta.columns,t.activeFilterBadges=r({},e.data.meta.activeFilterBadges),t.items=Object.values(e.data.data),t.meta=e.data.meta,t.shouldRequestFirstPage)return t.request();t.loading=!1,t.initializing=!1,t.afterRequestCompleted(e)})).catch((function(e){t.$axios.isCancel(e)||(t.loading=!1,t.initializing=!1,e.request&&!e.response||t.$toast.error(e.response?e.response.data.message:__("Something went wrong"),{duration:null}))}))):this.loading=!1},afterRequestCompleted:function(t){},sorted:function(t,e){this.sortColumn=t,this.sortDirection=e},removeRow:function(t){var e=t.id,i=_.indexOf(this.rows,_.findWhere(this.rows,{id:e}));this.rows.splice(i,1),0===this.rows.length&&location.reload()},popState:function(t){var e=this;this.pushQuery&&t.state&&(this.popping=!0,this.parameters=t.state.parameters,this.$nextTick((function(){e.popping=!1})))},pushState:function(){if(this.pushQuery&&!this.popping){var t=this.parameters,e=Object.keys(this.parameterMap),i=new URLSearchParams(Object.fromEntries(e.filter((function(e){return t.hasOwnProperty(e)})).map((function(e){return[e,t[e]]}))));window.history.pushState({parameters:t},"","?"+i.toString())}},autoApplyState:function(){var t=this;if(this.pushQuery&&window.location.search){var e=new URLSearchParams(window.location.search),i=Object.fromEntries(e.entries());this.popping=!0,this.parameters=i,this.$nextTick((function(){t.popping=!1}))}}}},undefined,undefined,!1,null,null,null);const c=t({mixins:[l.exports],props:{collection:String},data:function(){return{cols:[{label:"Title",field:"title",visible:!0}],listingKey:"entries",requestUrl:cp_url("collections/".concat(this.collection,"/entries")),offset:0}},watch:{loading:function(t){t||(this.offset=(this.page-1)*this.perPage)}},methods:{shorten:function(t){if(!t)return 0;if(t<1e3)return t;for(var e,i=0,n=["K","M","B","T"];i<n.length&&(e=n[i],!((t/=1e3)<1e3));i++);return"".concat(Number(t.toFixed(t<10?1:0))).concat(e)}}},(function(){var t=this,e=t._self._c;return e("div",[t.initializing?e("div",{staticClass:"loading"},[e("loading-graphic")],1):t._e(),t._v(" "),!t.initializing&&t.items.length?e("data-list",{attrs:{rows:t.items,columns:t.cols,sort:!1,"sort-column":t.sortColumn,"sort-direction":t.sortDirection},scopedSlots:t._u([{key:"default",fn:function(i){return function(t){if(null==t)throw new TypeError("Cannot destructure "+t)}(i),e("div",{},[e("data-list-table",{attrs:{loading:t.loading},scopedSlots:t._u([{key:"cell-title",fn:function(i){var n,r=i.row,s=i.displayIndex;return[e("div",{staticClass:"flex justify-between items-center"},[e("div",{staticClass:"flex-1 flex"},[e("div",{staticClass:"mr-2 px-1 bg-grey-30 text-grey-80 rounded-full"},[t._v("\n                                "+t._s(t.offset+s+1)+"\n                            ")]),t._v(" "),e("a",{attrs:{href:r.edit_url}},[t._v(t._s(r.title))])]),t._v(" "),e("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"".concat(null!==(n=r.pageviews)&&void 0!==n?n:0," views"),expression:"`${entry.pageviews ?? 0} views`"}],staticClass:"flex-0"},[t._v("\n                            "+t._s(t.shorten(r.pageviews))+"\n                            "+t._s(t.__("views"))+"\n                        ")])])]}}],null,!0)}),t._v(" "),1!=t.meta.last_page?e("data-list-pagination",{staticClass:"py-1 border-t bg-grey-20 rounded-b-lg text-sm",attrs:{"resource-meta":t.meta,"scroll-to-top":!1},on:{"page-selected":t.selectPage}}):t._e()],1)}}],null,!1,997474102)}):t.initializing||t.items.length?t._e():e("p",{staticClass:"p-2 pt-1 text-sm text-grey-50"},[t._v("\n        "+t._s(t.__("There are no entries in this collection"))+"\n    ")])],1)}),[],!1,null,null,null).exports;Statamic.booting((function(){Statamic.$components.register("pageviews-fieldtype",e),Statamic.$components.register("popular-widget",c)}))})();